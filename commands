########################## Prerequisites ###########################

gcloud projects listecho "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list

sudo apt-get install apt-transport-https ca-certificates gnupg

curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -

sudo apt-get update && sudo apt-get install google-cloud-sdk

gcloud version

gcloud init

gcloud auth login

gcloud config set project iginew47 

gcloud projects list  # просмотреть список проектов

gcloud config set project natural-aria-321108

gcloud config set compute/region us-west1

gcloud config set compute/zone us-west1-c

###################### Installing the client tools #####################

wget -q --show-progress --https-only --timestamping \
  https://storage.googleapis.com/kubernetes-the-hard-way/cfssl/1.4.1/linux/cfssl \
  https://storage.googleapis.com/kubernetes-the-hard-way/cfssl/1.4.1/linux/cfssljson
  
chmod +x cfssl cfssljson

sudo mv cfssl cfssljson /usr/local/bin/

cfssl version

cfssljson --version

wget https://storage.googleapis.com/kubernetes-release/release/v1.21.0/bin/linux/amd64/kubectl # установка kubectl

chmod +x kubectl

sudo mv kubectl /usr/local/bin/

########################### Provisioning compute resources #################################

gcloud compute networks list # просто нужно знать

gcloud compute networks create kubernetes-the-hard-way --subnet-mode custom # создаем vpc network

# создаем подсеть
gcloud compute networks subnets create kubernetes \
  --network kubernetes-the-hard-way \
  --range 10.240.0.0/24
  
# создаем правила файерволла для внутреннего взаимодействия
gcloud compute firewall-rules create kubernetes-the-hard-way-allow-internal \
  --allow tcp,udp,icmp \
  --network kubernetes-the-hard-way \
  --source-ranges 10.240.0.0/24,10.200.0.0/16
  
# создаем правила файерволла для внешнего взаимодействия
gcloud compute firewall-rules create kubernetes-the-hard-way-allow-external \
  --allow tcp:22,tcp:6443,icmp \
  --network kubernetes-the-hard-way \
  --source-ranges 0.0.0.0/0
  
